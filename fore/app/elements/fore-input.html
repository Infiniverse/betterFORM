<polymer-element name="fore-input" extends="HTMLInputElement" attributes="name type" on-fore-bind="foreBind" on-keyup="{{updateValue}}" on-blur="{{updateValue}}" >
    <template>
        <content></content>
    </template>
    <script>
        Polymer('fore-input', {
            path: '',
            model: '',

/*
            observe : {
                value: 'valueChanged'
            },
*/

            created: function () {
                console.log("fore-input created ...");
                console.log("this: ", this);
                console.log("this: ", this.getAttribute('name'));
            },

            updateValue:function(e){
                console.log("Event: ", e);
                console.log("updatevalue: ", e.originalTarget.value);
                //this.value= e.originalTarget.value;
                //this.model.getInstance('defaultInstance').data.contact.contacttype = e.originalTarget.value;
                Path.get(this.getPath()).setValueFrom(this.model.getInstance('defaultInstance'), e.originalTarget.value);
                this.super();
                //this.model.getInstance('defaultInstance').setValue('contact.' + this.name, e.originalTarget.value)
                //Platform.performMicrotaskCheckpoint();
            },

/*
            bind: function (name, obj, path) {
                console.log("custom binding",this);
                if (name === 'value') {
                    console.log("Bind: NAME: ", name, ' OBJECT: ', obj, ' PATH :', path);
                    document.getElementById("defaultInstance").setValue("boohoo")

                } else {
                    HTMLElement.prototype.bind.call(this, name, obj, path);
                }
            }
*/
            enteredView: function () {
//                console.log("FORE-INPUT :: enteredView : Path : ", this.getPath());
            },

            foreBind: function(e, details, sender) {
//                console.log("fore-input foreBind ...");

                sender.model = details.form.xfModel;
                //var pp = "" + sender.getPath();
                console.log("VALUE: " , Path.get(sender.getPath()).getValueFrom(details.form.xfModel.getInstance('defaultInstance')));

                sender.observer = new PathObserver(sender.model.getInstance('defaultInstance'), sender.getPath(), function(newValue, oldValue) {

                    var currentValue = ShadowDOMPolyfill.unwrap(this);
                    console.log("newValue ", newValue);
                    if(currentValue.value != newValue){
                        console.log("PathObserver changed: old: ", oldValue, ' new:', newValue);

                        $(ShadowDOMPolyfill.unwrap(this)).val(newValue);
                    }
//                    Platform.performMicrotaskCheckpoint();

                },sender);
                console.log("obs: " , sender.observer);
//                Platform.performMicrotaskCheckpoint();
            },


            getInstance: function() {
                this.parentNode.host;
            },

            getPath: function() {
                var absolutePath = this.name;
                var node = this;

//                console.log("node name : ",absolutePath);
//                console.log("node.parentNode : ",node.parentNode);
//                console.log("node.parentNode.name : ",node.parentNode.getAttribute('name'));
//                console.log("node.parentNode.tagname : ",node.parentNode.localName);

                while (node.parentNode !== undefined && node.parentNode.tagName.toUpperCase() != 'FORM') {
//                while (node.parentNode !== undefined && node.parentNode.hasAttribute("name")) {
//                    console.log("step : " , node.parentNode.getAttribute('name'));
                    absolutePath = node.parentNode.getAttribute('name') + '.' + absolutePath;
                    node = node.parentNode;
                }
                return this.ownerForm.name  + '.' + absolutePath;
            }

        });
    </script>
</polymer-element>
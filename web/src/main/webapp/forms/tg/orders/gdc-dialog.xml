<xhtml:div
	xmlns:xhtml="http://www.w3.org/1999/xhtml"
	xmlns:xforms="http://www.w3.org/2002/xforms"
	xmlns:events="http://www.w3.org/2001/xml-events"
	xmlns:bf="http://betterform.sourceforge.net/xforms"
	xmlns:bfc="http://betterform.sourceforge.net/xforms/controls">

	<div style="display: none;">
		<xforms:model id="GDC" events:event="xforms-refresh" events:propagate="cancel">

			<!--<xforms:instance
				xmlns=""
				id="articleGroups"
				src="{$articleurl}?action=groups" /> -->
			<xforms:instance
				xmlns=""
				id="articleGroups"
				src="{$articleurl}.grp.xml" />

			<xforms:instance
				xmlns=""
				id="artikelen">
				<item> <itemId> <gtinName></gtinName></itemId></item>
			</xforms:instance>

			<xforms:instance
				xmlns=""
				id="artikel">
				<item />
			</xforms:instance>



			<xforms:instance
				id="articleSelection"
				xmlns="">
				<Artikel> <add-trigger>true</add-trigger> <Artikelsearch /> <Artikelidentificatie /> <ArtikelFunctionalName /> </Artikel>
			</xforms:instance>


			<xforms:bind
				nodeset="instance('articleSelection')/add-trigger" />
				<!-- 
				readonly="instance('articleSelection')/Artikelidentificatie = '' or not(boolean-from-string(instance('articleSelection')/add-trigger))" />
				-->


			<xforms:submission
				id="article.search"
				indent="true"
				method="get"
				replace="instance"
				instance="artikelen">
				<!-- <xforms:resource value="concat(bf:appContext('articleurl'),'?action=func&amp;param=',encode-for-uri(instance('articleSelection')/ArtikelFunctionalName))" /> -->
				<xforms:resource value="concat(bf:appContext('articleurl'),'.arts.xml')" />

				<xforms:action events:event="xforms-submit-done">
					<xforms:setvalue
						ref="instance('articleSelection')/Artikelidentificatie"
						value="''" />
					<xforms:setvalue
						ref="instance('articleSelection')/Artikelsearch"
						value="''" />
					<xforms:setvalue
						ref="instance('articleSelection')/ArtikelFunctionalName"
					value="''" />
					<xforms:setvalue
						ref="instance('articleSelection')/add-trigger"
						value="true()" />
					<xforms:script type="text/javascript">
						<![CDATA[
					var selectbox = dojo.byId("articleselectionlist-value");
					selectbox.selectedIndex = -1;
				]]>
					</xforms:script>
				</xforms:action>


			</xforms:submission>


			<xforms:submission
				id="article.get"
				indent="true"
				method="get"
				replace="instance"
				instance="artikel">

				<!--<xforms:resource value="concat(bf:appContext('articleurl'),'?action=byid&amp;param=',encode-for-uri(instance('articleSelection')/Artikelidentificatie))" /> -->
				<xforms:resource value="concat(bf:appContext('articleurl'),'.art.xml')" />
				
				

				<xforms:action events:event="xforms-submit-done">
					<!-- xforms:message level="ephemeral">Done!</xforms:message-->
					<xforms:dispatch
						name="addLine"
						targetid="_DESADV_Consignment_LineInfos_LineInfo" />
						
					<xforms:setvalue
						ref="instance('articleSelection')/ArtikelFunctionalName"
						value="''" />
					<xforms:setvalue
						ref="instance('articleSelection')/Artikelidentificatie"
						value="''" />
					<xforms:setvalue
						ref="instance('articleSelection')/add-trigger"
						value="'true'" />

					<xforms:dispatch name="unloadSubforms" targetid="_DESADV_Consignment_LineInfos_LineInfo"/>
				</xforms:action>
				

				 

				<xforms:action events:event="xforms-submit-error">
					<xforms:message level="ephemeral">ERROR!</xforms:message>
					<xforms:setvalue
						ref="instance('articleSelection')/add-trigger"
						value="'true'" />
				</xforms:action>

			</xforms:submission>

			<bfc:show
				dialog="gdcdialog"
				events:event="chooseArticle" />

		</xforms:model>
	</div>
	<xforms:group>
		<bfc:dialog
			id="gdcdialog"
			style="width:600px">
			<xforms:label lang="en">Add article</xforms:label>
			<xforms:label lang="nl">Artikel toevoegen</xforms:label>
			<xforms:label lang="es">AÃ±adir artÃ­culo</xforms:label>
			<xforms:label lang="pt">Adicionar Item</xforms:label>
			<xforms:group
				appearance="full"
				model="GDC">
				<xforms:group
					appearance="full"
					ref="instance('articleSelection')">


					<xforms:select1
						ref="ArtikelFunctionalName"
						appearance="compact"
						size="5"
						id="articlegrouplist"
						model="GDC">
						
						<xforms:label lang="en">Article group</xforms:label>
						<xforms:label lang="nl">Artikel groep</xforms:label>
						<xforms:label lang="es">Grupo de productos</xforms:label>
						<xforms:label lang="pt">Grupo de produtos</xforms:label>
						
						<xforms:itemset
							nodeset="instance('articleGroups')/item/funcName"
							model="GDC">
							<xforms:label ref="." />
							<xforms:value ref="." />
						</xforms:itemset>

						<xforms:action events:event="xforms-value-changed">
							<xforms:send submission="article.search" />
							<xforms:setvalue
								ref="instance('articleSelection')/Artikelidentificatie"
								value="''" />
							<xforms:script type="text/javascript">
                     	    	 var selectbox = dojo.byId("articleselectionlist-value");
                     	    	 selectbox.selectedIndex = -1;
                     	    </xforms:script>
						</xforms:action>
					</xforms:select1>
					
					<xforms:input
						id="Artikelsearch"
						ref="Artikelsearch"
						style="min-width:400px"
						bf:incremental-delay="500"
						incremental="true"
						model="GDC">

						<xforms:label lang="en">Article search</xforms:label>
						<xforms:label lang="nl">Artikel zoeken</xforms:label>
						<xforms:label lang="es">Artículo búsqueda</xforms:label>
						<xforms:label lang="pt">Artigo pesquisa</xforms:label>

						<xforms:action events:event="xforms-value-changed">
							<xforms:setvalue
								ref="instance('articleSelection')/Artikelidentificatie"
								value="''" />
							<xforms:script type="text/javascript">
                     	    	 var selectbox = dojo.byId("articlegrouplist-value");
                     	    	 selectbox.selectedIndex = -1;
                     	    </xforms:script>
						</xforms:action>
					</xforms:input>

					<xforms:select1
						ref="Artikelidentificatie"
						xhtml:style="min-width: 550px;  height: 100px"
						appearance="compact"
						size="5"
						xhtml:size="5"
						id="articleselectionlist">
						<xforms:label lang="en">Article name</xforms:label>
						<xforms:label lang="nl">Artikel naam</xforms:label>
						<xforms:label lang="es">Descripción del producto</xforms:label>
						<xforms:label lang="pt">A descrição do produto</xforms:label>

						<!-- nodeset="instance('artikelen')/item/itemId" -->

						<xforms:itemset
							
							nodeset="bf:sort(instance('artikelen')/item[contains(lower-case(gtinName), lower-case(instance('articleSelection')/Artikelsearch))]/itemId, ../gtinName)"
							style="min-width: 550px;  height: 100px; position:relative">

							<xforms:label ref="../gtinName" />
							<xforms:value ref="." />
						</xforms:itemset>
					</xforms:select1>
					
					<xforms:group appearance="minimal">
						<xforms:trigger
							ref="instance('articleSelection')/add-trigger"
							id="okdialog">
							<xforms:label lang="en">Add</xforms:label>
							<xforms:label lang="nl">Toevoegen</xforms:label>
							<xforms:label lang="es">AÃ±adir</xforms:label>
							<xforms:label lang="pt">Adicionar</xforms:label>
							<xforms:setvalue
								ref="instance('articleSelection')/add-trigger"
								value="false"
								events:event="DOMActivate" />
								
								<bfc:hide dialog="gdcdialog" events:event="DOMActivate"/>

							<xforms:script type="text/javascript">
				                     	    	 var selectbox = dojo.byId("articlegrouplist-value");
				                     	    	 selectbox.selectedIndex = -1;
				            					</xforms:script>

							<xforms:send
								submission="article.get"
								events:event="DOMActivate" />

						</xforms:trigger>
						<xforms:trigger>
							<xforms:label lang="en">Cancel</xforms:label>
							<xforms:label lang="nl">Annuleren</xforms:label>
							<xforms:label lang="es">Cancelar</xforms:label>
							<xforms:label lang="pt">Cancelar</xforms:label>
							<xforms:hint>Close dialog</xforms:hint>
							<bfc:hide
								dialog="gdcdialog"
								events:event="DOMActivate" />

						</xforms:trigger>
					</xforms:group>
				</xforms:group>
			</xforms:group>
		</bfc:dialog>


	</xforms:group>

</xhtml:div>

<?xml version="1.0"?>
<!-- @author Joern Turner -->

<html xmlns:ev="http://www.w3.org/2001/xml-events"
      xmlns:xsd="http://www.w3.org/2001/XMLSchema"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <title>XML Mailer</title>

        <xf:model id="mail">
            <xf:instance id="user">
                <data xmlns="">
                    <user name="" pass=""/>
                    <prefs defaultFolder="inbox" numMsgs="20"/>
                    <currentMsg num=""/>
                </data>
            </xf:instance>

            <xf:instance id="messages" xmlns="">
                <data>
                    <messages user="audrey" mbxname="INBOX" offset="0" total="11">
                        <message selected="false" level="1">
                            <index>11</index>
                            <date>2006-11-25T17:40:24+0100</date>
                            <from>
                                <name>Becky Burwell</name>
                                <address>burwell@graflex.org</address>
                            </from>
                            <subject>Who's there?</subject>
                            <content>Hi ther whover you are.
                                mommy
                            </content>
                        </message>
                        <message selected="false"  level="2">
                            <index>10</index>
                            <date>2006-11-25T06:51:27+0100</date>
                            <from>
                                <name>Leah Kolt</name>
                                <address>leah.kolt@gmail.com</address>
                            </from>
                            <subject>Re: Re: guess who?</subject>
                            <content></content>
                        </message>
                        <message selected="false" level="3">
                            <index>9</index>
                            <date>2006-11-25T03:25:35+0100</date>
                            <from>
                                <name>Leah Kolt</name>
                                <address>leah.kolt@gmail.com</address>
                            </from>
                            <subject>Re: guess who?</subject>
                            <content></content>
                        </message>
                        <message selected="false" level="1">
                            <index>9</index>
                            <date>2006-11-25T03:25:35+0100</date>
                            <from>
                                <name>Leah Kolt</name>
                                <address>leah.kolt@gmail.com</address>
                            </from>
                            <subject>Re: guess who?</subject>
                            <content></content>
                        </message>
                        <message selected="false" level="1">
                            <index>9</index>
                            <date>2006-11-25T03:25:35+0100</date>
                            <from>
                                <name>Leah Kolt</name>
                                <address>leah.kolt@gmail.com</address>
                            </from>
                            <subject>Re: guess who?</subject>
                            <content></content>
                        </message>
                        <message selected="false" level="1">
                            <index>9</index>
                            <date>2006-11-25T03:25:35+0100</date>
                            <from>
                                <name>Leah Kolt</name>
                                <address>leah.kolt@gmail.com</address>
                            </from>
                            <subject>Re: guess who?</subject>
                            <content></content>
                        </message>
                        <message selected="false" level="1">
                            <index>9</index>
                            <date>2006-11-25T03:25:35+0100</date>
                            <from>
                                <name>Leah Kolt</name>
                                <address>leah.kolt@gmail.com</address>
                            </from>
                            <subject>Re: guess who?</subject>
                            <content>kdhfg;lkaf hsafkhdsa khgkahfg kjsagkjs agfkjs agfkhfg
                                lkh fghsgk jsa hfafkjg hsahgsa
                                kjfhgksajgajshflksajglksajhflksajhfkasj hfgkjs
                                agksajkasjglksa
                                jgksajhgksajhfglkajshfglksajhgkjsafhg
                            </content>
                        </message>
                    </messages>
                </data>
            </xf:instance>
            <xf:bind nodeset="instance('messages')">
                <xf:bind nodeset="messages/message">
                    <xf:bind id="b-selected" nodeset="@selected" type="boolean"/>
                </xf:bind>
            </xf:bind>
            <xf:instance id="results">
                <empty xmlns=""/>
            </xf:instance>

            <xf:instance id="composition">
                <data xmlns="">
                    <from>
                        <name/>
                        <address/>
                    </from>
                    <to>
                        <name/>
                        <address/>
                    </to>
                    <subject/>
                    <date/>
                    <content composeHTML="false"/>
                </data>
            </xf:instance>
            <xf:bind nodeset="instance('composition')">
                <xf:bind nodeset="from/address" constraint="string-length(.) &gt; 0"
                         required="true()"/>
                <xf:bind nodeset="to/address" constraint="string-length(.) &gt; 0"
                         required="true()"/>
                <xf:bind nodeset="content/@composeHTML" type="boolean"/>
            </xf:bind>



            <xf:instance id="mailboxes">
                <data xmlns="">
                </data>
            </xf:instance>
        </xf:model>
        <style type="text/css">
            #buttons .trigger{display:inline;}

            #r-messages{
                padding:1.2em;
                width:100%;
            }
            #r-messages .col-2{
                width:75%;
            }
            .repeat-header{
                <!--background: url(./resources/images/gradient-gray.png) repeat-x;-->
                height:30px;
            }
            .repeat-index{
                <!--background: url(./resources/images/gradient-gray.png) repeat-x;-->
                height:24px;
            }
            .repeat-index td .output{
                padding-top:0.4em;
            }
            .repeat-item{
                height:24px;            
            }
            .repeat-item td .output{
                padding-top:0.4em;
            }
            .textarea .value{
                height:150px;
            }

            <!--#compose .textarea .value{margin-left: 0px;}-->

            #text-content .value{width:100%;}
        </style>
    </head>

    <body>
        <xf:switch>
            <xf:case id="login-case">
                <xf:group ref="instance('user')">
                    <xf:input id="login-user" ref="user/@name">
                        <xf:label>User:</xf:label>
                    </xf:input>
                    <xf:secret ref="user/@pass">
                        <xf:label>Password:</xf:label>
                    </xf:secret>
                    <xf:trigger>
                        <xf:label>Login</xf:label>
                        <xf:action ev:event="DOMActivate">
                            <xf:toggle case="logged-in-case"/>
                            <!--<xf:send submission="list"/>-->
                        </xf:action>
                    </xf:trigger>
                </xf:group>
            </xf:case>
            <xf:case id="logged-in-case">
                <xf:group ref="instance('user')"  id="buttons">
                    <xf:trigger>
                        <xf:label>Get new Mail</xf:label>
                        <xf:action>
                            <!-- todo: fetch messages -->
                        </xf:action>
                    </xf:trigger>
                    <xf:trigger>
                        <xf:label>New Message</xf:label>
                        <xf:toggle case="c-edit"/>
                    </xf:trigger>
                </xf:group>

                <xf:repeat id="r-messages" nodeset="instance('messages')/messages/message" appearance="compact">
                    <xf:input ref="@selected">
                        <xf:label/>
                    </xf:input>
                    <xf:switch>
                        <xf:case id="c-default">
                            <xf:trigger ref="subject" appearance="minimal">
                                <xf:label ref="."/>
                                <xf:toggle case="c-read-message"/>
                                <xf:hint>click to read</xf:hint>
                            </xf:trigger>
                        </xf:case>
                        <xf:case id="c-read-message">
                            <xf:trigger ref="subject" appearance="minimal">
                                <xf:label ref="."/>
                                <xf:toggle case="c-default"/>
                            </xf:trigger>
                            <div style="width:100%;margin-top:20px;padding:5px;">
                                <xf:output ref="content"/>
                            </div>
                        </xf:case>
                    </xf:switch>
                    <xf:output ref="from/name">
                        <xf:label>Sender</xf:label>
                        <xf:toggle case="c-edit"/>
                    </xf:output>
                    <xf:output ref="date">
                        <xf:label>Date</xf:label>
                    </xf:output>
                </xf:repeat>
                <xf:switch>
                    <xf:case id="c-edit-dummy"/>
                    <xf:case id="c-edit">
                        <xf:group id="compose" ref="instance('composition')">
                            <xf:input ref="to/name">
                                <xf:label>To: </xf:label>
                            </xf:input>
                            <xf:input ref="content/@composeHTML">
                                <xf:label>compose HTML</xf:label>
                                <xf:toggle ev:event="xforms-value-changed" case="c-compose-html" if="boolean-from-string(.)"/>
                                <xf:toggle ev:event="xforms-value-changed" case="c-compose-text" if="not(boolean-from-string(.))"/>
                            </xf:input>
                            <xf:switch>
                                <xf:case id="c-compose-text">
                                    <xf:textarea id="text-content" ref="content">
                                        <xf:label/>
                                    </xf:textarea>
                                </xf:case>
                                <xf:case id="c-compose-html">
                                    <xf:textarea ref="content" mediatype="text/html">
                                        <xf:label/>
                                    </xf:textarea>
                                </xf:case>
                            </xf:switch>
                            <xf:group appearance="minimal">
                                <xf:trigger>
                                    <xf:label>Cancel</xf:label>
                                </xf:trigger>
                                <xf:trigger>
                                    <xf:label>Send</xf:label>
                                </xf:trigger>
                            </xf:group>
                        </xf:group>
                    </xf:case>
                </xf:switch>
            </xf:case>
        </xf:switch>
    </body>
</html>


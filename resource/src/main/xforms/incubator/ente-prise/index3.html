<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
  Copyright (c) 2012. betterFORM Project - http://www.betterform.de
  Licensed under the terms of BSD License

    todo:jt: add app group button somewhere to create a new app group
    todo:jt: add dnd to reorder apps and allow installation when repo view is active
    todo:jt: add escape key handler when in repo view to switch back
  -->

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Status</title>
        <script type="text/javascript" src="/bfResources/scripts/dojo/dojo.js"
                data-dojo-config="parseOnLoad: true"> </script>
        <link href='http://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
        <link id="themeStyles" rel="stylesheet" href="/bfResources/scripts/dijit/themes/claro/claro.css"/>

        <style type="text/css">
            @import "/bfResources/scripts/dojo/resources/dnd.css";
            @import "style.css";


            body #content #existIcon #addAppIcon{
                /*display: none;*/

                height: 22px;
                position: absolute;
                right: 7px;
                bottom: 8px;
                width: 22px;
                opacity: 0.5;
            }
/*
            body #content #existIcon #logo:hover #addAppIcon{
                display: block;
                height: 36px;
                width: 36px;
                position: absolute;
                right: 20px;
                top:58px;
            }
*/
        </style>
        <script type="text/javascript">
            dojo.require("dijit.form.Button");
            dojo.require("dijit.Dialog");
            dojo.require("dijit.form.TextBox");
            dojo.require("dojox.fx.flip");
            dojo.require("dojo.fx");
            dojo.require("dojo.fx.easing");
            dojo.require("dojo.dnd.Source");

            // ##################### opening an app group ##########################
            // ##################### opening an app group ##########################
            // ##################### opening an app group ##########################
            running = false;//flag used with animations to prevent them from being interrupted by new events

            /*
            This function opens/closes app groups. It will fadeOut all li items but the one the user clicked and
            insert the hidden <ul> which is a child of the same <li> as a following sibling into the top list.
             */
            function toggleAppGroup(n){
                n.focus();
                if(!running){
                    running=true;

                    var appListElement= dojo.byId("appList");
                    var parentitem = dojo.byId(n.parentNode.id); //we're fired from a button below <li>. Step up to get the list item

                    if(dojo.hasClass(appListElement,"appGroupOpen")){
                        //go back to home screen (or parent group)
                        dojo.query("#appList > li").forEach(function(selectTag){
                            // hide all list items but the current one
                            if(selectTag != parentitem){
                                dojo.style(selectTag,"opacity","0");
                                dojo.style(selectTag,"display","inline-block");
                                var isRunning = running;
                                var anim1 = dojo.fadeIn({
                                    node:selectTag,
                                    duration:500,
                                    onBegin:function(){
                                        dojo.style(selectTag, {
                                            height: "150px",
                                            marginTop: "15px",
                                            marginBottom: "15px"
                                        });

                                    },
                                    onEnd:function(){
                                        running=false;
                                    }

                                    /*
                                     onEnd:function(){
                                     dojo.style(selectTag,"display","inline-block");
                                     }
                                     */

                                });
                                anim1.play();
                            }
                        });
                        dojo.removeClass(appListElement,"appGroupOpen");

                        var openGroup = dojo.query("#appList > .appGroup")[0];
                        var openGroupList = dojo.query("#appList > .appGroup > ul")[0]
                        //hide
                        dojo.style(openGroupList,"display","none");
                        //move group back
                        dojo.place(openGroupList,parentitem,0);
                        dojo.destroy(openGroup);
                    }else{
                        // hide all list items to give place for grouped apps
                        dojo.query("#appList > li").forEach(function(selectTag){
                            if(selectTag != parentitem){
                                var anim1 = dojo.fadeOut({
                                    node:selectTag,
                                    duration:200
                                });
                                var anim2 = dojo.animateProperty({
                                    node: selectTag,
                                    properties: {
                                        height: {start: 150, end: 0, unit: "px"},
                                        marginTop:{start:15,end:0, unit:"px"},
                                        marginBottom:{start:15,end:10, unit:"px"}
                                    },
                                    duration: 550  ,
                                    onEnd:function(){
                                        running=false;
                                    }
                                })
                                dojo.fx.combine([anim1,anim2]).play();
                            }
                        });

                        // remember we are in an app group - store value on outermost ul 'appList'
                        dojo.addClass(appListElement,"appGroupOpen");

                        //place and show group contents
                        //prepare a <li class="appGroup"> to hold the sublist
                        var groupListItem = dojo.create("li",{class:"appGroup"});
                        dojo.place(groupListItem, parentitem, "after");

                        //look for <ul> below current appGroupItem (the one that called this function) - should be present and hidden with style="display:none;"
                        var appGroupContent = dojo.query("> ul",parentitem)[0];
                        dojo.place(appGroupContent, groupListItem, 0);
                        dojo.style(appGroupContent,"display","inline-block");
                    }
                }

            }

            function toggleRepoView(n){
                console.debug("repoView");
                var appListElement= dojo.byId("appList");
                if(dojo.hasClass(appListElement,"repoViewOpen")){
                    //repo view is active

                    dojo.removeClass(appListElement,"repoViewOpen");
                    dojo.style("availableApps","display","none");
                }else{
                    //switch to repo view
                    dojo.addClass(appListElement,"repoViewOpen");
                    dojo.style("availableApps","display","inline-block");
                }


/*
                dojo.animateProperty({
                    node: selectTag,
                    properties: {
                            -moz-transform:rotate(45deg);
                -webkit-transform:rotate(45deg);
                -o-transform:rotate(45deg);
                transform:rotate(45deg);

                        height: {start: 150, end: 0, unit: "px"},
                        marginTop:{start:15,end:0, unit:"px"},
                        marginBottom:{start:15,end:10, unit:"px"}
                    },
                    duration: 550  ,
                    onEnd:function(){
                        running=false;
                    }
                }).play();
*/

            }
            function openInline(n){
                dojo.style("availableApps","display","none");
                dojo.style("appList","display","none");
                dojo.style("inlineAppArea","display","inline-block");

            }
            function closeApp(n){
                dojo.style("availableApps","display","none");
                dojo.style("appList","display","inline-block");
                dojo.style("inlineAppArea","display","none");

            }

            dojo.ready(function(){
                console.debug("ready");
                // ############## routines to handle eXist app card #####################
                // ############## routines to handle eXist app card #####################
                // ############## routines to handle eXist app card #####################
                dojo.connect(dojo.byId("repoConfigIcon"), "onclick", function(e){
//                    console.debug("exist icon clicked");

                    var existIconNode = dojo.byId("existIcon");
                    if(dojo.hasClass(existIconNode,"backside")){
                        console.debug("to front side");
                        var anim = dojox.fx.flip({
                            node: existIconNode,
                            dir: "right",
                            depth: .5,
                            duration:400
                        });
                        dojo.connect(anim, "onEnd", this, function(){
                            var n = dojo.byId("existIcon");
                            dojo.removeClass(existIconNode,"backside");
                        })
                        anim.play();
                    }else{
                        console.debug("to back side");
                        var anim = dojox.fx.flip({
                            node: existIconNode,
                            dir: "left",
                            depth: .5,
                            duration:400
                        });
                        dojo.connect(anim, "onEnd", this, function(){
                            dojo.addClass(existIconNode,"backside");

                        })
                        anim.play();
                    }
                });


/*
todo:global close handler for open group
                dojo.connect(dojo.document,"onclick",function(e){
                    console.debug("click anywhere",e);
                    var appListItem = dojo.byId("appList");
                    //if some app group is open close it
                    if(dojo.hasClass(appListItem,"appGroupOpen")){
                        var openGroup = dojo.query(".appGroupOpen")[0];
                        console.debug("open group: ", openGroup);
                        toggleAppGroup(openGroup);
                        dojo.removeClass(appListItem,"appGroupOpen");
                        e.preventDefault();
                        e.stopPropagation();
                    }
                });
*/

            });

        </script>
        <style type="text/css">
        </style>
    </head>
    <body>

        <div id="header">
<!--
            <div class="startButton" data-dojo-type="dijit.form.DropDownButton">
                <span id="user">admin</span>
                <div data-dojo-type="dijit.TooltipDialog">
                    <label for="name">Name:</label> <input data-dojo-type="dijit.form.TextBox" id="name" name="name"><br>
                    <label for="hobby">Hobby:</label> <input data-dojo-type="dijit.form.TextBox" id="hobby" name="hobby"><br>
                </div>
            </div>
-->
            <img src="configuration.png" alt="Start" id="startButton"/>
            <div id="user">admin</div>
        </div>
        <div id="content">

            <!-- ########################### this div is used as inline space for applications #################### -->
            <div id="inlineAppArea">
                <img src="close_exit.png" onclick="closeApp(this);"/>
            </div>
            <!--
            ################################### List for available apps (not yet installed) - Repo View #################
            -->
            <ul id="availableApps" dojoType="dojo.dnd.Source" class="container">
                <li class="twoColumn dojoDndItem">
                    <button>
                        <span>available3</span>
                    </button>
                </li>
                <li class="dojoDndItem">
                    <button>
                        <img src="statistic.png" />
                        <span>available1</span>
                    </button>
                </li>
                <li class="dojoDndItem">
                    <button>
                        <img src="statistic.png" />
                        <span>available2</span>
                    </button>
                </li>
<!--
                <button id="closeRepo">
                    <img src="close_exit.png"/>
                </button>
-->
            </ul>

            <!--<div id="logo" class="twocolumn">-->
                <!--<img src="existdb.gif" align="right"/>-->
            <!--</div>-->
            <ul id="appList" dojoType="dojo.dnd.Source" class="container">
                <li id="existIcon" class="twoColumn dojoDndItem">
                    <button  id="logo">
                        <img src="existdb.gif" align="right"/>
                    </button>
                    <div id="existIconFront">
<!--
                        <div id="logo">
                        </div>
-->
                        <button id="repoConfigIcon"><img src="config-gear.png" /></button>
                        <!--<button id="repoConfigIcon"><img src="configuration.png" /></button>-->
                        <button id="addAppIcon" onclick="toggleRepoView(this);"><img src="plusss.png"/></button>
                        <!--<button id="addAppIcon" onclick="toggleRepoView(this);"><img src="add.png"/></button>-->
                    </div>
                    <div id="existIconBack">
                        repo config
                    </div>
                </li>
                <li id="users" class="appGroupIcon dojoDndItem">
                    <button onclick="toggleAppGroup(this);">
                        <img src="user-admin.png" />
                        <span>Users</span>
                    </button>
                    <ul style="display: none;">
                        <li>
                            <button>
                                <img src="statistic.png" />
                                <span>Sub 1</span>
                            </button>
                        </li>
                        <li>
                            <button>
                                <img src="statistic.png" />
                                <span>Sub 2</span>
                            </button>
                        </li>
                        <li>
                            <button>
                                <img src="statistic.png" />
                                <span>Sub 3</span>
                            </button>
                        </li>
                        <li>
                            <button>
                                <img src="statistic.png" />
                                <span>Sub 4</span>
                            </button>
                        </li>
                    </ul>
                </li>
                <!--insert here -->
                <!-- use id+"AppGroup" as id e.g. 'usersAppGroup" if the groupIcon has id 'users' as above -->
<!--
                <li id="usersAppGroup" class="appGroup">
                </li>
-->
                <li class="dojoDndItem">
                    <button id="backup">
                        <img src="help.png" />
                        <span>Backup</span>
                    </button>
                </li>
                <!-- to display group icon and group contents at the same time but separate the group icon
                has to be in the parent list. -->
                <li id="groupA" class="appGroupIcon dojoDndItem">
                    <button id="groupALink" href="#" onclick="toggleAppGroup(this);">
                        <img src="folder.png" />
                        <span>App Group A</span>
                    </button>
                    <ul style="display: none;">
                        <li>
                            <button>
                                <img src="statistic.png" />
                                <span>Sub 5</span>
                            </button>
                        </li>
                        <li>
                            <button>
                                <img src="statistic.png" />
                                <span>Sub 6</span>
                            </button>
                        </li>
                        <li>
                            <button>
                                <img src="statistic.png" />
                                <span>Sub 7</span>
                            </button>
                        </li>
                        <li>
                            <button>
                                <img src="statistic.png" />
                                <span>Sub 8</span>
                            </button>
                        </li>
                    </ul>
                </li>
<!--
                <li id="groupAGroup" class="appGroup">
                </li>
-->
                <!-- ########## Example for an inline app ########### -->
                <li class="dojoDndItem">
                    <button onclick="openInline(this);" data-appLink="myfiles/mysample.html#fook">
                        <img src="statistic.png" />
                        <span>Inline App 1</span>
                    </button>
                </li>
                <li class="twoColumn dojoDndItem">
                    <button>
                        <span id="exide">eXide</span>
                    </button>
                </li>
                <li class="dojoDndItem">
                    <button>
                        <img src="statistic.png" />
                        <span>System Information</span>
                    </button>
                </li>
                <li class="dojoDndItem">
                    <button>
                        <img src="statistic.png" />
                        <span>System Information</span>
                    </button>
                </li>
            </ul>

        </div>
<!--
        <div id="workspace">
            here is the area for working
        </div>
-->
    </body>
</html>

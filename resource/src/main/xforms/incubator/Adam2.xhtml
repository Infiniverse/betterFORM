<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xh="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:bf="http://betterform.sourceforge.net/xforms" xmlns:xf="http://www.w3.org/2002/xforms">
<head>
    <xf:model>
        <xf:instance>
            <evaluation xmlns="">
                <name/>
                <organisation/>
                <email/>
                <course id="3day_dpt_2011">
                    <name>3 Day Development and Performance Training (30th Nov, 1st and 2nd Dec 2011)</name>
                    <days>
                        <day>
                            <date>2011-11-30</date>
                            <name>XML, XPath, XQuery and XSLT basics</name>
                            <trainer-name>Adam Retter</trainer-name>
                            <quality>
                                <trainer>
                                    <effectiveness>5</effectiveness>
                                    <helpfulness/>
                                    <knowledge/>
                                    <comments/>
                                </trainer>
                                <exercises>
                                    <suitability/>
                                    <adequate-time/>
                                    <comments/>
                                </exercises>
                                <general>
                                    <topics/>
                                    <balance-exercises/>
                                    <balance-presentations/>
                                    <relevance/>
                                    <group-discussions/>
                                    <comments/>
                                </general>
                            </quality>
                        </day>
                        <day>
                            <date>2011-12-01</date>
                            <name>Application development in XQuery</name>
                            <trainer-name>Wolfgang Meier</trainer-name>
                            <quality>
                                <trainer>
                                    <effectiveness>5</effectiveness>
                                    <helpfulness/>
                                    <knowledge/>
                                    <comments/>
                                </trainer>
                                <exercises>
                                    <suitability/>
                                    <adequate-time/>
                                    <comments/>
                                </exercises>
                                <general>
                                    <topics/>
                                    <balance-exercises/>
                                    <balance-presentations/>
                                    <relevance/>
                                    <group-discussions/>
                                    <comments/>
                                </general>
                            </quality>
                        </day>
                        <day>
                            <date>2011-12-02</date>
                            <name>Advanced development; Performance and Optimisation</name>
                            <trainer-name>Wolfgang Meier</trainer-name>
                            <quality>
                                <trainer>
                                    <effectiveness>5</effectiveness>
                                    <helpfulness/>
                                    <knowledge/>
                                    <comments/>
                                </trainer>
                                <exercises>
                                    <suitability/>
                                    <adequate-time/>
                                    <comments/>
                                </exercises>
                                <general>
                                    <topics/>
                                    <balance-exercises/>
                                    <balance-presentations/>
                                    <relevance/>
                                    <group-discussions/>
                                    <comments/>
                                </general>
                            </quality>
                        </day>
                    </days>
                    <quality>
                        <trainer/>
                        <topics/>
                        <exercises/>
                        <food/>
                        <comments/>
                    </quality>
                </course>
                <metadata>
                    <created/>
                </metadata>
            </evaluation>
        </xf:instance>
        <xf:instance id="courses">
            <courses xmlns="">
                <course id="3day_dpt_2011">
                    <name>3 Day Development and Performance Training (30th Nov, 1st and 2nd Dec 2011)</name>
                    <days>
                        <day>
                            <date>2011-11-30</date>
                            <name>XML, XPath, XQuery and XSLT basics</name>
                            <trainer-name>Adam Retter</trainer-name>
                            <quality>
                                <trainer>
                                    <effectiveness>5</effectiveness>
                                    <helpfulness/>
                                    <knowledge/>
                                    <comments/>
                                </trainer>
                                <exercises>
                                    <suitability/>
                                    <adequate-time/>
                                    <comments/>
                                </exercises>
                                <general>
                                    <topics/>
                                    <balance-exercises/>
                                    <balance-presentations/>
                                    <relevance/>
                                    <group-discussions/>
                                    <comments/>
                                </general>
                            </quality>
                        </day>
                        <day>
                            <date>2011-12-01</date>
                            <name>Application development in XQuery</name>
                            <trainer-name>Wolfgang Meier</trainer-name>
                            <quality>
                                <trainer>
                                    <effectiveness>5</effectiveness>
                                    <helpfulness/>
                                    <knowledge/>
                                    <comments/>
                                </trainer>
                                <exercises>
                                    <suitability/>
                                    <adequate-time/>
                                    <comments/>
                                </exercises>
                                <general>
                                    <topics/>
                                    <balance-exercises/>
                                    <balance-presentations/>
                                    <relevance/>
                                    <group-discussions/>
                                    <comments/>
                                </general>
                            </quality>
                        </day>
                        <day>
                            <date>2011-12-02</date>
                            <name>Advanced development; Performance and Optimisation</name>
                            <trainer-name>Wolfgang Meier</trainer-name>
                            <quality>
                                <trainer>
                                    <effectiveness>5</effectiveness>
                                    <helpfulness/>
                                    <knowledge/>
                                    <comments/>
                                </trainer>
                                <exercises>
                                    <suitability/>
                                    <adequate-time/>
                                    <comments/>
                                </exercises>
                                <general>
                                    <topics/>
                                    <balance-exercises/>
                                    <balance-presentations/>
                                    <relevance/>
                                    <group-discussions/>
                                    <comments/>
                                </general>
                            </quality>
                        </day>
                    </days>
                    <quality>
                        <trainer/>
                        <topics/>
                        <exercises/>
                        <food/>
                        <comments/>
                    </quality>
                </course>
                <course id="2day_dpt_2011">
                    <name>2 Day Development and Performance Training (1st and 2nd Dec 2011)</name>
                    <days>
                        <day>
                            <date>2011-12-01</date>
                            <name>Application development in XQuery</name>
                            <trainer-name>Wolfgang Meier</trainer-name>
                            <quality>
                                <trainer>
                                    <effectiveness>5</effectiveness>
                                    <helpfulness/>
                                    <knowledge/>
                                    <comments/>
                                </trainer>
                                <exercises>
                                    <suitability/>
                                    <adequate-time/>
                                    <comments/>
                                </exercises>
                                <general>
                                    <topics/>
                                    <balance-exercises/>
                                    <balance-presentations/>
                                    <relevance/>
                                    <group-discussions/>
                                    <comments/>
                                </general>
                            </quality>
                        </day>
                        <day>
                            <date>2011-12-02</date>
                            <name>Advanced development; Performance and Optimisation</name>
                            <trainer-name>Wolfgang Meier</trainer-name>
                            <quality>
                                <trainer>
                                    <effectiveness>5</effectiveness>
                                    <helpfulness/>
                                    <knowledge/>
                                    <comments/>
                                </trainer>
                                <exercises>
                                    <suitability/>
                                    <adequate-time/>
                                    <comments/>
                                </exercises>
                                <general>
                                    <topics/>
                                    <balance-exercises/>
                                    <balance-presentations/>
                                    <relevance/>
                                    <group-discussions/>
                                    <comments/>
                                </general>
                            </quality>
                        </day>
                    </days>
                    <quality>
                        <trainer/>
                        <topics/>
                        <exercises/>
                        <food/>
                        <comments/>
                    </quality>
                </course>
            </courses>
        </xf:instance>
        <xf:bind nodeset="name" constraint="bf:match(., '[A-Za-z0-9\s]{3,}', '')"/>
        <xf:bind nodeset="organisation" constraint="string-length(.) &gt; 2"/>
        <xf:bind nodeset="email" constraint="string-length(.) &gt; 3" type="email"/>

        <!-- bind integer type for range controls -->
        <xf:bind nodeset="course/days/day">
            <xf:bind nodeset="quality/trainer">
                <xf:bind nodeset="effectiveness" type="integer"/>
            </xf:bind>
        </xf:bind>
        <xf:submission id="s-send" method="post" resource="http://localhost:8088/exist/rest/db/existsolutions.com/training/evaluation/data">
            <xf:action ev:event="xforms-submit-error">
                <xf:message>Registration failed. Please fill in valid values</xf:message>
            </xf:action>
            <xf:action ev:event="xforms-submit-done">
                <xf:message>You have been registered successfully.</xf:message>
            </xf:action>
        </xf:submission>
    </xf:model>
</head>
<body>
<xf:group appearance="bf:verticalTable">
    <xf:label>Evaluation Form</xf:label>
    <xf:group appearance="compact">
        <xf:title>Optional Contact</xf:title>
        <xf:input ref="name" incremental="true">
            <xf:label>Your name:</xf:label>
        </xf:input>
        <xf:input ref="organisation" incremental="true">
            <xf:label>Organisation:</xf:label>
        </xf:input>
        <xf:input ref="email" incremental="true">
            <xf:label>email:</xf:label>
        </xf:input>
    </xf:group>
    <xf:select1 appearance="minimal" ref="course">
        <xf:itemset nodeset="instance('courses')/course">
            <xf:label ref="name"/>
            <xf:action ev:event="xforms-select">
                <xf:insert nodeset="instance()/course" origin="instance('courses')/course[@id = context()/@id]"/>
            </xf:action>


        </xf:itemset>

    </xf:select1>
</xf:group>
<xf:repeat nodeset="course/days/day">
    <xf:group>
        <xf:output ref="name"/>
        <xf:output value="format-date(date, '[FNn], [D1o] [MNn] [Y]', 'en', (), ())"/>
        <xf:output ref="trainer-name"/>
        <xf:group ref="quality/trainer">
            <xf:label>Please rate the Trainer</xf:label>

            <!-- THIS WORKS -->
            <!-- <xf:output ref="effectiveness"/> -->

            <!-- THIS DOESNT, stack complains that
                xforms-binding-exception: datatype not supported by range control: string at /html[1]/body[1]/xf:repeat[1]/xf:group[1]/xf:group[1]/xf:group[1]/xf:range[1]
                HOWEVER, I do have a binding to type="integer" above?
                appearance="bf:rating"
            -->

            <xf:range  ref="effectiveness" start="1" end="10" step="1" incremental="true">
                <xf:label>Effectiveness:</xf:label>
            </xf:range>

        </xf:group>
    </xf:group>
</xf:repeat>
</body>
</html>
<project name="eXist xml db Installer" default="deploy2exist" basedir=".">

    <xmlproperty file="../../build.properties.xml" semanticAttributes="true" keepRoot="false"/>

    <property name="web.dir" value="${basedir}/../../web"/>
    <property name="core.dir" value="${basedir}/../../core"/>
    <property name="target.dir" value="${basedir}/target"/>
    <property name="webapp.dir" value="${basedir}/target/${web.app.name}"/>

    <target name="prepare-exist-deployment"
            description="creates a zip archive to be dropped into eXist">
            <ant antfile="${web.dir}/build.xml" target="clean" dir="${web.dir}" inheritall="false"/>


            <ant antfile="${web.dir}/build.xml" target="build-dojo" dir="${web.dir}" inheritall="false">
                    <property name="target.dir" value="${target.dir}"/>
                    <property name="webapp.dir" value="${webapp.dir}"/>
            </ant>

            <delete dir="${webapp.dir}/forms/apps"/>
            <delete dir="${webapp.dir}/forms/incubator"/>
            <delete dir="${webapp.dir}/forms/test"/>
            <delete dir="${webapp.dir}/forms/v3"/>


            <delete dir="${webapp.dir}/resources/scripts/betterform"/>
            <delete dir="${webapp.dir}/resources/scripts/dijit"/>
            <delete dir="${webapp.dir}/resources/scripts/dojo"/>
            <delete dir="${webapp.dir}/resources/scripts/dojox"/>
            <delete dir="${webapp.dir}/resources/scripts/util"/>

            <delete includeemptydirs="true">
                <fileset dir="${webapp.dir}/resources/scripts/release/dojo" includes="**/tests/"/>
            </delete>
        <delete includeemptydirs="true">
            <fileset dir="${webapp.dir}/resources/scripts/release/dojo/dojox/atom" includes="**/tests/"/>
            <fileset dir="${webapp.dir}/resources/scripts/release/dojo" includes="**/tests/"/>
        </delete>

            <zip basedir="${webapp.dir}" zipfile="${webapp.dir}.zip"/>
        
    </target>

    

</project>

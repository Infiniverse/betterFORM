<?xml version="1.0" encoding="UTF-8" ?>
<!-- $Id: build.xml,v 1.90 2006/11/16 23:55:43 joernt Exp $ -->
<project id="betterform-project" name="betterForm Project" default="build-release" basedir=".">

    <xmlproperty file="build.properties.xml"
                 semanticAttributes="true" keepRoot="false"/>

    <property name="core.dir" value="${basedir}/core"/>
    <property name="web.dir" value="${basedir}/web"/>
    <property name="betty.dir" value="${basedir}/betty"/>
    <property name="server.dir" value="${basedir}/tools/server"/>
    <property name="release.dir" value="${basedir}/release"/>
    <property name="extension.dir" value="${basedir}/eXist"/>
    <property name="installer.dir" value="${basedir}/tools/installer"/>

    <!-- local Web properties -->

    <target name="build-release" description="build everthing needed for a release" depends="cleanout-release">
        <mkdir dir="${release.dir}-${web.app.version}"/>
        <!-- Cleanout everthing before we start -->
        <antcall target="clean-all"/>

        <mkdir dir="${release.dir}-${web.app.version}/src-dist"/>
        <!-- create src-distribution -->
        <ant antfile="build.xml" target="create-src-distribution" inheritall="false"/>

        <copy file="target/${web.app.name}-${web.app.version}-src.zip" todir="${release.dir}-${web.app.version}/src-dist"/>

        <!-- create core-distribution -->
        <mkdir dir="${release.dir}-${web.app.version}/core-dist"/>

        <!-- SRC and BIN -->
        <ant antfile="${core.dir}/build.xml" target="distribute" dir="${core.dir}" inheritall="false"/>

        <copy file="${core.dir}/target/${core.app.name}-${core.app.version}-src.zip" todir="${release.dir}-${web.app.version}/core-dist"/>
        <copy file="${core.dir}/target/${core.app.name}-${core.app.version}-bin.zip" todir="${release.dir}-${web.app.version}/core-dist"/>
        <copy file="${core.dir}/target/${core.app.name}-${core.app.version}-bin.tar.gz" todir="${release.dir}-${web.app.version}/core-dist"/>

        <!-- create web-distribution -->
        <mkdir dir="${release.dir}-${web.app.version}/web-dist"/>

        <!-- SRC -->
        <ant antfile="${web.dir}/build.xml" target="distribute" dir="${web.dir}" inheritall="false"/>
        <copy file="${web.dir}/target/${web.app.name}-${web.app.version}-src.zip" todir="${release.dir}-${web.app.version}/web-dist"/>

        <!-- BIN -->
        <ant antfile="${web.dir}/build.xml" target="package" dir="${web.dir}" inheritall="false"/>
        <copy file="${web.dir}/target/${web.app.name}-${web.app.version}.war" todir="${release.dir}-${web.app.version}/web-dist"/>

        <!-- create betterFORM exist extension -->
<!-- 17.02.2010
        <mkdir dir="${release.dir}-${web.app.version}/extension-dist"/>
-->

        <!-- installer zip -->
<!-- 17.02.2010
        <mkdir dir="${release.dir}-${web.app.version}/extension-dist/exist-extension-installer"/>
        <ant antfile="${extension.dir}/build.xml" target="package" dir="${extension.dir}" inheritall="false"/>
        <copy todir="${release.dir}-${web.app.version}/extension-dist/exist-extension">
            <fileset file="${extension.dir}/target/**"/>
       </copy>
-->

<!-- ???
            <copy file="${extension.dir}/target/exist-extension-installer/betterform.zip" todir="${release.dir}-${web.app.version}/extension-dist/exist-extension-installer"/>
-->
        <!-- betterForm and XRX zip -->
<!-- ???
            <mkdir dir="${release.dir}-${web.app.version}/extension-dist/exist-extension"/>

            <ant antfile="${extension.dir}/build.xml" target="package" dir="${extension.dir}" inheritall="false"/>
            <copy file="${extension.dir}/target/betterform.zip" todir="${release.dir}-${web.app.version}/extension-dist/exist-extension"/>
            <copy file="${extension.dir}/target/xrx.zip" todir="${release.dir}-${web.app.version}/extension-dist/exist-extension"/>
-->
        <!-- create installer -->
        <mkdir dir="${release.dir}-${web.app.version}/installer-dist"/>

        <!-- build installer -->
        <ant antfile="${installer.dir}/build-betterFORM-XRX.xml" target="create-betterFormInstaller" dir="${installer.dir}" inheritall="false"/>
        <copy todir="${release.dir}-${web.app.version}/installer-dist">
            <fileset dir="${installer.dir}/target" includes="*.jar"/>
        </copy>
                                                                    
    </target>

    <target name="cleanout-release">
          <delete dir="release-${web.app.version}"/>
    </target>

    <target name="clean-all">
        <ant antfile="build.xml" target="clean-all" inheritall="false"/>
        <ant antfile="${extension.dir}/build.xml" target="clean" dir="${extension.dir}" inheritall="false"/>
        <ant antfile="${installer.dir}/build.xml" target="clean" dir="${installer.dir}" inheritall="false"/>
    </target>

</project>
